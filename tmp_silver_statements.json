[
  "CREATE TABLE IF NOT EXISTS dim_scoreboard (\n  scoreboard_id  BIGSERIAL PRIMARY KEY,\n  external_id    TEXT UNIQUE,\n  name           TEXT,\n  generated_at   TIMESTAMPTZ,\n  raw_id         BIGINT UNIQUE,\n  ingested_at    TIMESTAMPTZ DEFAULT now()\n)",
  "CREATE TABLE IF NOT EXISTS dim_team (\n  team_id   BIGSERIAL PRIMARY KEY,\n  ent_id    TEXT UNIQUE,\n  team_name TEXT\n)",
  "CREATE TABLE IF NOT EXISTS dim_discipline (\n  discipline_id BIGSERIAL PRIMARY KEY,\n  code          TEXT UNIQUE,\n  label         TEXT\n)",
  "CREATE TABLE IF NOT EXISTS dim_athlete (\n  athlete_id BIGSERIAL PRIMARY KEY,\n  ath_id     TEXT UNIQUE,\n  fname      TEXT,\n  lname      TEXT,\n  gender     TEXT,\n  bdate      DATE\n)",
  "CREATE TABLE IF NOT EXISTS map_roster (\n  scoreboard_id BIGINT NOT NULL,\n  athlete_id    BIGINT NOT NULL,\n  team_id       BIGINT NOT NULL,\n  discipline_id BIGINT NOT NULL,\n  slot_id       TEXT NULL,\n  class_id      TEXT NULL,\n  eligible      BOOLEAN NULL,\n  status        TEXT NULL,\n  PRIMARY KEY (scoreboard_id, athlete_id, discipline_id)\n)",
  "CREATE TABLE IF NOT EXISTS dim_stage (\n  stage_id     BIGSERIAL PRIMARY KEY,\n  discipline_id BIGINT NOT NULL,\n  stage_num    SMALLINT NOT NULL,\n  stage_name   TEXT,\n  UNIQUE (discipline_id, stage_num)\n)",
  "CREATE TABLE IF NOT EXISTS dim_series (\n  series_id  BIGSERIAL PRIMARY KEY,\n  stage_id   BIGINT NOT NULL,\n  series_num SMALLINT NOT NULL,\n  UNIQUE (stage_id, series_num)\n)",
  "CREATE TABLE IF NOT EXISTS fact_stage_series_result (\n  scoreboard_id BIGINT NOT NULL,\n  athlete_id    BIGINT NOT NULL,\n  team_id       BIGINT NOT NULL,\n  discipline_id BIGINT NOT NULL,\n  stage_num     SMALLINT NOT NULL,\n  series_num    SMALLINT NOT NULL,\n  value         NUMERIC NULL,\n  payload       JSONB NULL,\n  inserted_at   TIMESTAMPTZ DEFAULT now()\n  ,PRIMARY KEY (scoreboard_id, athlete_id, stage_num, series_num)\n)",
  "CREATE TABLE IF NOT EXISTS fact_penalty (\n  scoreboard_id BIGINT NOT NULL,\n  athlete_id    BIGINT NOT NULL,\n  stage_num     SMALLINT NOT NULL,\n  series_num    SMALLINT NULL,\n  penalty_code  TEXT NOT NULL,\n  penalty_value NUMERIC NOT NULL,\n  inserted_at   TIMESTAMPTZ DEFAULT now()\n)",
  "CREATE UNIQUE INDEX IF NOT EXISTS ux_fact_penalty_unique ON fact_penalty (\n  scoreboard_id, athlete_id, stage_num, penalty_code, (COALESCE(series_num,0))\n)",
  "CREATE TABLE IF NOT EXISTS fact_stage_total (\n  scoreboard_id BIGINT NOT NULL,\n  athlete_id    BIGINT NOT NULL,\n  stage_num     SMALLINT NOT NULL,\n  raw_time      NUMERIC NULL,\n  penalties     NUMERIC NULL,\n  final_time    NUMERIC NULL,\n  PRIMARY KEY (scoreboard_id, athlete_id, stage_num)\n)",
  "CREATE TABLE IF NOT EXISTS silver_property (\n  scoreboard_id BIGINT NOT NULL,\n  entity_type   TEXT NOT NULL CHECK (entity_type IN ('athlete','team','scoreboard')),\n  entity_id     BIGINT NOT NULL,\n  prop_key      TEXT NOT NULL,\n  prop_value    JSONB NOT NULL,\n  PRIMARY KEY (scoreboard_id, entity_type, entity_id, prop_key)\n)",
  "CREATE INDEX IF NOT EXISTS ix_fact_result_discipline_stage ON fact_stage_series_result (discipline_id, stage_num, value)",
  "CREATE INDEX IF NOT EXISTS ix_map_roster_scoreboard_team ON map_roster (scoreboard_id, team_id)"
]